<!doctype html>
<html lang="en">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>TTT</title>
	<link rel="stylesheet" href="/styles.css" />

	<style>
		.grid {
			display: grid;
			grid-template-columns: repeat(3, 1fr);
			/* 3 equal columns */
			grid-template-rows: repeat(3, 1fr);
			/* 3 equal rows */
			gap: 10px;
			/* optional spacing between items */
			width: 300px;
			height: 300px;
		}

		.grid>button {
			background: #ccc;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 24px;
		}
	</style>

</head>

<body>
	<h1 id="heading"></h1>

	<div class="grid" id="myGrid">
		<button>1</button><button>2</button><button>3</button>
		<button>4</button><button>5</button><button>6</button>
		<button>7</button><button>8</button><button>9</button>
	</div>

	<button id="machineButton">Machine first</button>
	<button id="resetButton">Start again</button><br>
	<output id="outputId" for="myGrid"></output>





	<script>
		fetch('/message')
			.then((resp) => resp.text())
			.then((text) => {
				const h1 = document.getElementById('heading');
				h1.textContent = text;
			});

		const machineBtn = document.getElementById('machineButton')
		document.getElementById('myGrid').addEventListener('click', function (event) {
			// Check if the element clicked (event.target) is a <td> element
			if (event.target.tagName === 'button') {
				machineBtn.disabled = true
				const tdId = event.target.id;
				const cell = document.getElementById(tdId);
				if (cell.textContent !== '') {
					// Cell is already filled, do nothing
					return;
				}
				console.debug(`You clicked on cell with ID: ${tdId}`)
				cell.textContent = 'X'; // Change the content of the clicked cell to 'X'
				let str = ''
				for (let i = 1; i <= 9; i++) {
					const el = document.getElementById('cell-' + i)
					const ch = el.textContent
					str += ch === '' ? '-' : ch
				}
				const output = document.getElementById('outputId');
				output.textContent = `"${str}"`
				fetch('/play', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ oldState: str })
				}).then(resp => resp.json())
					.then(text => console.debug('POST /play text: ', text))
					.catch(err => console.error('POST /play err: ', err));
			}
		});

		machineBtn.addEventListener('click', async function () {
			const str = '---------'
			fetch('/play', {
				method: 'POST',
				headers: { 'Content-Type': 'application/json' },
				body: JSON.stringify({ oldState: str })
			}).then(resp => resp.json())
				.then(text => console.debug('POST /play text: ', text))
				.catch(err => console.error('POST /play err: ', err));
			this.disabled = true
		});

		document.getElementById('resetButton').addEventListener('click', function () {
			for (let i = 1; i <= 9; i++) {
				const el = document.getElementById('cell-' + i)
				el.textContent = ''
			}
			const output = document.getElementById('outputId');
			output.textContent = ''
			machineBtn.disabled = false
		});
	</script>
</body>

</html>